# 全球新闻管理系统 - 项目文档

## 目录

- [1. 系统概述](#1-系统概述)
- [2. 系统架构](#2-系统架构)
  - [2.1 技术架构](#21-技术架构)
  - [2.2 项目结构](#22-项目结构)
- [3. 核心模块详解](#3-核心模块详解)
  - [3.1 用户认证与权限管理模块](#31-用户认证与权限管理模块)
    - [3.1.1 登录模块](#311-登录模块)
    - [3.1.2 权限控制模块](#312-权限控制模块)
  - [3.2 用户管理模块](#32-用户管理模块)
  - [3.3 权限管理模块](#33-权限管理模块)
    - [3.3.1 角色管理](#331-角色管理)
    - [3.3.2 权限管理](#332-权限管理)
  - [3.4 新闻管理模块](#34-新闻管理模块)
    - [3.4.1 新闻草稿箱](#341-新闻草稿箱)
    - [3.4.2 新闻撰写](#342-新闻撰写)
    - [3.4.3 新闻分类管理](#343-新闻分类管理)
  - [3.5 审核管理模块](#35-审核管理模块)
    - [3.5.1 审核新闻](#351-审核新闻)
    - [3.5.2 审核列表](#352-审核列表)
  - [3.6 发布管理模块](#36-发布管理模块)
    - [3.6.1 待发布新闻](#361-待发布新闻)
    - [3.6.2 已发布新闻](#362-已发布新闻)
    - [3.6.3 已下线新闻](#363-已下线新闻)
  - [3.7 前台展示模块](#37-前台展示模块)
    - [3.7.1 新闻列表](#371-新闻列表)
    - [3.7.2 新闻详情](#372-新闻详情)
  - [3.8 公共组件](#38-公共组件)
    - [3.8.1 侧边菜单](#381-侧边菜单)
    - [3.8.2 顶部导航](#382-顶部导航)
- [4. 数据管理](#4-数据管理)
  - [4.1 数据库结构](#41-数据库结构)
  - [4.2 状态管理](#42-状态管理)
  - [4.3 数据流程图](#43-数据流程图)
  - [4.4 API接口设计](#44-api接口设计)
- [5. 权限控制流程](#5-权限控制流程)
  - [5.1 权限控制流程图](#51-权限控制流程图)
  - [5.2 权限控制详细流程](#52-权限控制详细流程)
  - [5.3 权限粒度](#53-权限粒度)
- [6. 新闻工作流](#6-新闻工作流)
  - [6.1 新闻工作流程图](#61-新闻工作流程图)
  - [6.2 新闻状态定义](#62-新闻状态定义)
  - [6.3 新闻工作流详细流程](#63-新闻工作流详细流程)
- [7. 系统配置](#7-系统配置)
  - [7.1 开发环境配置](#71-开发环境配置)
    - [7.1.1 前端配置](#711-前端配置)
    - [7.1.2 后端模拟配置](#712-后端模拟配置)
    - [7.1.3 HTTP请求配置](#713-http请求配置)
  - [7.2 生产环境配置](#72-生产环境配置)
    - [7.2.1 构建配置](#721-构建配置)
    - [7.2.2 性能优化配置](#722-性能优化配置)
  - [7.3 系统参数配置](#73-系统参数配置)
    - [7.3.1 新闻相关参数](#731-新闻相关参数)
    - [7.3.2 权限相关参数](#732-权限相关参数)
  - [7.4 第三方服务配置](#74-第三方服务配置)
    - [7.4.1 富文本编辑器配置](#741-富文本编辑器配置)
    - [7.4.2 图表配置](#742-图表配置)
- [8. 扩展与优化方向](#8-扩展与优化方向)
- [9. 部署指南](#9-部署指南)
  - [9.1 开发环境部署](#91-开发环境部署)
    - [9.1.1 前端部署](#911-前端部署)
    - [9.1.2 环境要求](#912-环境要求)
  - [9.2 生产环境部署](#92-生产环境部署)
    - [9.2.1 构建生产版本](#921-构建生产版本)
    - [9.2.2 Nginx配置示例](#922-nginx配置示例)
    - [9.2.3 后端API部署](#923-后端api部署)
  - [9.3 持续集成/持续部署(CI/CD)](#93-持续集成持续部署cicd)
- [10. 常见问题与解决方案](#10-常见问题与解决方案)
  - [10.1 登录问题](#101-登录问题)
  - [10.2 权限问题](#102-权限问题)
  - [10.3 新闻管理问题](#103-新闻管理问题)
  - [10.4 富文本编辑器问题](#104-富文本编辑器问题)
  - [10.5 性能优化](#105-性能优化)
- [11. 附录](#11-附录)
  - [11.1 常用代码片段](#111-常用代码片段)
    - [11.1.1 权限检查](#111-权限检查)
    - [11.1.2 日期格式化](#112-日期格式化)
    - [11.1.3 数据过滤](#113-数据过滤)
  - [11.2 开发参考资料](#112-开发参考资料)
    - [11.2.1 官方文档](#121-官方文档)
    - [11.2.2 学习资源](#122-学习资源)
    - [11.2.3 推荐工具](#123-推荐工具)
  - [11.3 项目依赖版本对照表](#113-项目依赖版本对照表)

## 1. 系统概述

全球新闻管理系统是一个基于React的新闻发布和管理平台，提供了完整的新闻撰写、审核、发布流程，以及用户权限管理功能。系统分为前台新闻展示和后台管理两大部分，支持多角色权限控制，实现了新闻全生命周期的管理。

## 2. 系统架构

### 2.1 技术架构

- **前端框架**：React 18.2.0
- **UI组件库**：Ant Design 5.26.2
- **路由管理**：React Router 6.14.2
- **状态管理**：Redux Toolkit + Redux Persist
- **HTTP请求**：Axios
- **富文本编辑**：Draft.js + React Draft WYSIWYG
- **数据可视化**：ECharts
- **日期处理**：Moment.js
- **模拟后端**：JSON Server

### 2.2 项目结构

```
├── public/                 # 静态资源
├── src/                    # 源代码
│   ├── components/         # 公共组件
│   │   ├── news-manage/    # 新闻管理组件
│   │   ├── publish-manage/ # 发布管理组件
│   │   ├── sandbox/        # 后台框架组件
│   │   └── user-manage/    # 用户管理组件
│   ├── redux/              # Redux状态管理
│   │   ├── reducers/       # Reducer定义
│   │   └── store.js        # Redux存储配置
│   ├── router/             # 路由配置
│   ├── util/               # 工具函数
│   └── views/              # 页面视图
│       ├── login/          # 登录页
│       ├── news/           # 新闻前台页面
│       └── sandbox/        # 后台管理页面
├── db.json                 # JSON Server数据库文件
└── package.json           # 项目依赖配置
```

## 3. 核心模块详解

### 3.1 用户认证与权限管理模块

#### 3.1.1 登录模块

- **文件路径**：`src/views/login/Login.js`
- **功能描述**：提供用户登录界面，验证用户身份，并将用户信息和权限存储到localStorage中。
- **关键实现**：
  - 使用Ant Design的Form组件实现登录表单
  - 通过Axios请求验证用户凭据
  - 登录成功后获取用户角色权限并存储
  - 使用粒子背景效果增强视觉体验

#### 3.1.2 权限控制模块

- **文件路径**：`src/router/IndexRouter.js`
- **功能描述**：基于用户角色权限动态生成路由，控制用户可访问的页面。
- **关键实现**：
  - 使用React Router 6实现路由管理
  - 动态路由生成与权限过滤
  - 路由守卫确保未登录用户重定向到登录页
  - 权限不足时显示无权限页面

### 3.2 用户管理模块

- **文件路径**：`src/views/sandbox/user-manage/UserList.js`
- **功能描述**：管理系统用户，包括添加、编辑、删除用户，以及管理用户状态和权限。
- **关键实现**：
  - 用户列表展示与分页
  - 用户状态切换（启用/禁用）
  - 用户添加与编辑表单
  - 基于角色的用户数据过滤
  - 区域管理员只能管理自己区域的编辑用户

### 3.3 权限管理模块

#### 3.3.1 角色管理

- **文件路径**：`src/views/sandbox/right-manage/RoleList.js`
- **功能描述**：管理系统角色，包括添加、编辑、删除角色，以及分配权限。
- **关键实现**：
  - 角色列表展示
  - 权限分配对话框
  - 权限树形结构展示

#### 3.3.2 权限管理

- **文件路径**：`src/views/sandbox/right-manage/RightList.js`
- **功能描述**：管理系统权限项，包括添加、编辑、删除权限。
- **关键实现**：
  - 权限列表展示
  - 权限项编辑
  - 权限状态管理

### 3.4 新闻管理模块

#### 3.4.1 新闻草稿箱

- **文件路径**：`src/views/sandbox/news-manage/NewsDraft.js`
- **功能描述**：管理用户创建的新闻草稿，可以编辑、删除草稿，或提交审核。
- **关键实现**：
  - 草稿列表展示
  - 草稿编辑、删除操作
  - 提交审核功能
  - 新闻分类过滤

#### 3.4.2 新闻撰写

- **文件路径**：`src/views/sandbox/news-manage/NewsAdd.js`
- **功能描述**：提供新闻撰写界面，包括标题、分类、内容编辑等功能。
- **关键实现**：
  - 富文本编辑器集成
  - 新闻分类选择
  - 草稿保存与提交审核

#### 3.4.3 新闻分类管理

- **文件路径**：`src/views/sandbox/news-manage/NewsCategory.js`
- **功能描述**：管理新闻分类，包括添加、编辑、删除分类。
- **关键实现**：
  - 分类列表展示
  - 分类编辑功能
  - 分类删除确认

### 3.5 审核管理模块

#### 3.5.1 审核新闻

- **文件路径**：`src/views/sandbox/audit-manage/Audit.js`
- **功能描述**：管理员审核提交的新闻，可以通过或驳回。
- **关键实现**：
  - 待审核新闻列表
  - 审核操作（通过/驳回）
  - 审核状态更新

#### 3.5.2 审核列表

- **文件路径**：`src/views/sandbox/audit-manage/AuditList.js`
- **功能描述**：显示用户提交的新闻的审核状态，包括待审核、已通过、已驳回。
- **关键实现**：
  - 审核状态分类展示
  - 撤销审核功能
  - 发布已通过审核的新闻

### 3.6 发布管理模块

#### 3.6.1 待发布新闻

- **文件路径**：`src/views/sandbox/publish-manage/Unpublished.js`
- **功能描述**：管理已审核通过但尚未发布的新闻，可以进行发布操作。
- **关键实现**：
  - 待发布新闻列表
  - 发布操作
  - 新闻状态更新

#### 3.6.2 已发布新闻

- **文件路径**：`src/views/sandbox/publish-manage/Published.js`
- **功能描述**：管理已发布的新闻，可以进行下线操作。
- **关键实现**：
  - 已发布新闻列表
  - 下线操作
  - 发布时间显示

#### 3.6.3 已下线新闻

- **文件路径**：`src/views/sandbox/publish-manage/Sunset.js`
- **功能描述**：管理已下线的新闻，可以进行删除或重新发布操作。
- **关键实现**：
  - 已下线新闻列表
  - 删除操作
  - 重新发布功能

### 3.7 前台展示模块

#### 3.7.1 新闻列表

- **文件路径**：`src/views/news/News.js`
- **功能描述**：展示已发布的新闻，按分类组织，提供浏览功能。
- **关键实现**：
  - 新闻分类展示
  - 新闻列表分页
  - 新闻链接跳转

#### 3.7.2 新闻详情

- **文件路径**：`src/views/news/Detail.js`
- **功能描述**：展示新闻详细内容，包括标题、作者、发布时间、内容等。
- **关键实现**：
  - 新闻内容渲染
  - 浏览量统计
  - 点赞功能
  - 相关信息展示

### 3.8 公共组件

#### 3.8.1 侧边菜单

- **文件路径**：`src/components/sandbox/SideMenu.js`
- **功能描述**：根据用户权限动态生成侧边导航菜单。
- **关键实现**：
  - 基于权限的菜单项过滤
  - 菜单折叠状态管理
  - 路由导航集成

#### 3.8.2 顶部导航

- **文件路径**：`src/components/sandbox/TopHeader.js`
- **功能描述**：提供顶部导航栏，包括折叠菜单按钮、面包屑导航、用户下拉菜单等。
- **关键实现**：
  - 菜单折叠控制
  - 用户信息显示
  - 退出登录功能

## 4. 数据管理

### 4.1 数据库结构

系统使用JSON Server模拟后端API，主要数据结构如下：

- **users**: 用户信息，包括用户名、密码、角色ID、区域等
  ```json
  {
    "id": 1,
    "username": "admin",
    "password": "123456",
    "roleId": 1,
    "region": "",
    "default": true,
    "roleState": true
  }
  ```

- **roles**: 角色信息，包括角色名称、权限列表等
  ```json
  {
    "id": 1,
    "roleName": "超级管理员",
    "roleType": 1,
    "rights": ["所有权限ID列表"]
  }
  ```

- **rights**: 一级权限项，包括菜单项和权限控制
  ```json
  {
    "id": 1,
    "title": "首页",
    "key": "/home",
    "pagepermisson": 1
  }
  ```

- **children**: 二级权限项，关联到一级权限
  ```json
  {
    "id": 3,
    "title": "用户列表",
    "rightId": 2,
    "key": "/user-manage/list",
    "grade": 2,
    "pagepermisson": 1
  }
  ```

- **news**: 新闻内容，包括标题、内容、分类、状态等
  ```json
  {
    "id": 1,
    "title": "新闻标题",
    "categoryId": 1,
    "content": "新闻内容",
    "region": "全球",
    "author": "admin",
    "roleId": 1,
    "auditState": 2,
    "publishState": 2,
    "createTime": 1615777743864,
    "star": 0,
    "view": 0,
    "publishTime": 1615777743864
  }
  ```

- **categories**: 新闻分类
  ```json
  {
    "id": 1,
    "title": "时事新闻",
    "value": "时事新闻"
  }
  ```

- **regions**: 区域信息
  ```json
  {
    "id": 1,
    "title": "全球",
    "value": "全球"
  }
  ```

### 4.2 状态管理

系统使用Redux Toolkit进行状态管理，主要包括：

- **CollapsedReducer**: 控制侧边菜单的折叠状态
  ```javascript
  // src/redux/reducers/CollapsedReducer.js
  import { createSlice } from '@reduxjs/toolkit'

  export const collapsedSlice = createSlice({
    name: 'collapsed',
    initialState: {
      isCollapsed: false
    },
    reducers: {
      changeCollapsed(state) {
        state.isCollapsed = !state.isCollapsed
      }
    }
  })

  export const { changeCollapsed } = collapsedSlice.actions
  export default collapsedSlice.reducer
  ```

- **LoadingReducer**: 控制全局加载状态
  ```javascript
  // src/redux/reducers/LoadingReducer.js
  import { createSlice } from '@reduxjs/toolkit'

  export const loadingSlice = createSlice({
    name: 'loading',
    initialState: {
      isLoading: false
    },
    reducers: {
      changeLoading(state) {
        state.isLoading = !state.isLoading
      }
    }
  })

  export const { changeLoading } = loadingSlice.actions
  export default loadingSlice.reducer
  ```

### 4.3 数据流程图

#### 4.3.1 基础数据流程图

```
┌─────────────┐      ┌─────────────┐      ┌─────────────┐
│   UI组件    │──────▶│  Redux Store │◀─────│   API请求   │
└─────────────┘      └─────────────┘      └─────────────┘
       │                     │                    ▲
       │                     │                    │
       ▼                     ▼                    │
┌─────────────┐      ┌─────────────┐      ┌─────────────┐
│  用户交互   │──────▶│ Action分发  │──────▶│ HTTP拦截器  │
└─────────────┘      └─────────────┘      └─────────────┘
```

#### 4.3.2 详细数据流程图

```
┌───────────────────────────────────────────────────────────────────┐
│                           前端应用                                 │
│                                                                   │
│  ┌─────────────┐    ┌─────────────┐    ┌─────────────────────┐    │
│  │             │    │  Redux      │    │  Redux Middleware   │    │
│  │  React组件  │───▶│  Action     │───▶│  (Thunk/Logger)     │    │
│  │             │    │  Creators   │    │                     │    │
│  └─────────────┘    └─────────────┘    └─────────────────────┘    │
│         ▲                                          │              │
│         │                                          ▼              │
│         │                                 ┌─────────────────────┐ │
│         │                                 │                     │ │
│         │                                 │  Redux Reducers     │ │
│         │                                 │                     │ │
│         │                                 └─────────────────────┘ │
│         │                                          │              │
│         │                                          ▼              │
│  ┌─────────────┐                         ┌─────────────────────┐ │
│  │             │                         │                     │ │
│  │  组件状态   │◀────────────────────────│  Redux Store        │ │
│  │  更新       │                         │  (State)            │ │
│  │             │                         │                     │ │
│  └─────────────┘                         └─────────────────────┘ │
│                                                   │              │
└───────────────────────────────────────────────────────────────────┘
                                                   │
                                                   ▼
┌───────────────────────────────────────────────────────────────────┐
│                           HTTP层                                  │
│                                                                   │
│  ┌─────────────┐    ┌─────────────┐    ┌─────────────────────┐    │
│  │             │    │             │    │                     │    │
│  │ Axios请求   │───▶│ 请求拦截器  │───▶│  API请求            │    │
│  │ 配置        │    │ (添加Token) │    │  (GET/POST/PATCH)   │    │
│  │             │    │             │    │                     │    │
│  └─────────────┘    └─────────────┘    └─────────────────────┘    │
│                                                   │              │
│                                                   ▼              │
│                                         ┌─────────────────────┐ │
│                                         │                     │ │
│                                         │  响应拦截器        │ │
│                                         │  (错误处理)        │ │
│                                         │                     │ │
│                                         └─────────────────────┘ │
│                                                   │              │
└───────────────────────────────────────────────────────────────────┘
                                                   │
                                                   ▼
┌───────────────────────────────────────────────────────────────────┐
│                           后端服务                                │
│                                                                   │
│  ┌─────────────┐    ┌─────────────┐    ┌─────────────────────┐    │
│  │             │    │             │    │                     │    │
│  │ JSON Server │───▶│ 数据处理    │───▶│  数据持久化         │    │
│  │ API路由     │    │             │    │  (db.json)          │    │
│  │             │    │             │    │                     │    │
│  └─────────────┘    └─────────────┘    └─────────────────────┘    │
│                                                                   │
└───────────────────────────────────────────────────────────────────┘
```

#### 4.3.3 数据流程说明

1. **用户界面交互流程**
   - 用户在React组件中进行交互（如点击按钮、提交表单）
   - 组件调用Redux Action Creator创建action
   - Action通过Redux中间件（如Thunk）处理异步逻辑
   - Reducer根据action更新Redux Store中的状态
   - 组件通过connect或useSelector获取更新后的状态并重新渲染

2. **HTTP请求流程**
   - 异步Action Creator调用Axios发起HTTP请求
   - 请求拦截器添加认证信息（如Token）和其他请求头
   - 发送请求到后端API
   - 响应拦截器处理响应数据和错误
   - 将处理后的数据通过Action传递给Reducer

3. **数据持久化流程**
   - Redux状态通过redux-persist持久化到localStorage
   - 用户刷新页面时，从localStorage恢复状态
   - 关键状态（如用户信息、权限数据）在登录时存储

4. **权限数据流程**
   - 用户登录后获取权限数据
   - 权限数据存储在Redux和localStorage中
   - 路由和UI组件根据权限数据动态渲染
   - API请求时携带权限信息进行后端验证

5. **新闻数据流程**
   - 新闻创建后保存为草稿状态
   - 提交审核后状态变更，进入审核流程
   - 审核通过后可发布，发布后在前台可见
   - 新闻状态变更通过API更新，并反映在Redux状态中

### 4.4 API接口设计

系统主要API接口如下：

#### 4.4.1 用户相关接口

| 接口 | 方法 | 描述 | 权限要求 |
|------|------|------|----------|
| `/users` | GET | 获取用户列表 | 管理员 |
| `/users` | POST | 创建新用户 | 管理员 |
| `/users/:id` | PATCH | 更新用户信息 | 管理员/自己 |
| `/users/:id` | DELETE | 删除用户 | 管理员 |

##### 获取用户列表

**请求参数**：
```
?_expand=role  // 展开role关联数据
?roleState=true  // 筛选启用状态的用户
```

**响应示例**：
```json
[
  {
    "id": 1,
    "username": "admin",
    "password": "123456",
    "roleId": 1,
    "region": "",
    "roleState": true,
    "default": true,
    "role": {
      "id": 1,
      "roleName": "超级管理员",
      "roleType": 1,
      "rights": ["所有权限ID列表"]
    }
  }
]
```

**代码示例**：
```javascript
// 获取用户列表
const getUserList = async () => {
  const response = await axios.get('/users?_expand=role');
  setDataSource(response.data);
};
```

##### 创建新用户

**请求体**：
```json
{
  "username": "editor",
  "password": "123456",
  "roleId": 3,
  "region": "亚洲",
  "roleState": true,
  "default": false
}
```

**响应示例**：
```json
{
  "id": 5,
  "username": "editor",
  "password": "123456",
  "roleId": 3,
  "region": "亚洲",
  "roleState": true,
  "default": false
}
```

#### 4.4.2 权限相关接口

| 接口 | 方法 | 描述 | 权限要求 |
|------|------|------|----------|
| `/rights` | GET | 获取一级权限列表 | 所有用户 |
| `/children` | GET | 获取二级权限列表 | 所有用户 |
| `/roles` | GET | 获取角色列表 | 管理员 |
| `/roles/:id` | PATCH | 更新角色权限 | 管理员 |

##### 获取权限列表

**请求参数**：
```
?_embed=children  // 包含子权限数据
```

**响应示例**：
```json
[
  {
    "id": 1,
    "title": "首页",
    "key": "/home",
    "pagepermisson": 1,
    "children": []
  },
  {
    "id": 2,
    "title": "用户管理",
    "key": "/user-manage",
    "pagepermisson": 1,
    "children": [
      {
        "id": 3,
        "title": "用户列表",
        "rightId": 2,
        "key": "/user-manage/list",
        "grade": 2,
        "pagepermisson": 1
      }
    ]
  }
]
```

**代码示例**：
```javascript
// 获取权限列表
const getRightsList = async () => {
  const response = await axios.get('/rights?_embed=children');
  setRightsList(response.data);
};
```

##### 更新角色权限

**请求体**：
```json
{
  "rights": ["权限ID列表"]
}
```

**响应示例**：
```json
{
  "id": 2,
  "roleName": "区域管理员",
  "roleType": 2,
  "rights": ["权限ID列表"]
}
```

#### 4.4.3 新闻相关接口

| 接口 | 方法 | 描述 | 权限要求 |
|------|------|------|----------|
| `/news` | GET | 获取新闻列表 | 根据状态不同 |
| `/news/:id` | GET | 获取新闻详情 | 所有用户/作者 |
| `/news` | POST | 创建新闻 | 编辑 |
| `/news/:id` | PATCH | 更新新闻信息 | 作者/审核员 |
| `/news/:id` | DELETE | 删除新闻 | 作者/管理员 |

##### 获取新闻列表

**请求参数**：
```
?author=用户名  // 按作者筛选
?publishState=2  // 按发布状态筛选（2表示已发布）
?_expand=category  // 展开分类数据
```

**响应示例**：
```json
[
  {
    "id": 1,
    "title": "新闻标题",
    "categoryId": 1,
    "content": "新闻内容",
    "region": "全球",
    "author": "admin",
    "roleId": 1,
    "auditState": 2,
    "publishState": 2,
    "createTime": 1615777743864,
    "star": 0,
    "view": 0,
    "publishTime": 1615777743864,
    "category": {
      "id": 1,
      "title": "时事新闻",
      "value": "时事新闻"
    }
  }
]
```

**代码示例**：
```javascript
// 获取已发布的新闻列表
const getPublishedNews = async () => {
  const response = await axios.get('/news?publishState=2&_expand=category');
  setNewsList(response.data);
};
```

##### 创建新闻

**请求体**：
```json
{
  "title": "新闻标题",
  "categoryId": 1,
  "content": "新闻内容",
  "region": "全球",
  "author": "admin",
  "roleId": 1,
  "auditState": 0,
  "publishState": 0,
  "createTime": 1615777743864,
  "star": 0,
  "view": 0
}
```

**响应示例**：
```json
{
  "id": 5,
  "title": "新闻标题",
  "categoryId": 1,
  "content": "新闻内容",
  "region": "全球",
  "author": "admin",
  "roleId": 1,
  "auditState": 0,
  "publishState": 0,
  "createTime": 1615777743864,
  "star": 0,
  "view": 0
}
```

#### 4.4.4 分类相关接口

| 接口 | 方法 | 描述 | 权限要求 |
|------|------|------|----------|
| `/categories` | GET | 获取新闻分类 | 所有用户 |
| `/categories` | POST | 创建新闻分类 | 管理员 |
| `/categories/:id` | PATCH | 更新新闻分类 | 管理员 |
| `/categories/:id` | DELETE | 删除新闻分类 | 管理员 |

##### 获取新闻分类

**响应示例**：
```json
[
  {
    "id": 1,
    "title": "时事新闻",
    "value": "时事新闻"
  },
  {
    "id": 2,
    "title": "环球经济",
    "value": "环球经济"
  }
]
```

**代码示例**：
```javascript
// 获取新闻分类
const getCategories = async () => {
  const response = await axios.get('/categories');
  setCategories(response.data);
};
```

#### 4.4.5 API调用通用模式

系统中API调用遵循以下模式：

1. **列表数据获取**：通常使用GET请求，并可能包含筛选、排序和关联数据展开参数
2. **详情数据获取**：通过ID获取单条数据，可能包含关联数据
3. **数据创建**：使用POST请求，提交表单数据
4. **数据更新**：使用PATCH请求，只更新变更的字段
5. **数据删除**：使用DELETE请求，通常需要二次确认

所有API请求都通过Axios发送，并配置了请求和响应拦截器：

```javascript
// src/util/http.js
import axios from 'axios'
import { store } from '../redux/store'
import { changeLoading } from '../redux/reducers/LoadingReducer'

axios.defaults.baseURL = 'http://localhost:8000'

// 请求拦截器
axios.interceptors.request.use(function (config) {
  // 显示loading
  store.dispatch(changeLoading())
  return config;
}, function (error) {
  return Promise.reject(error);
});

// 响应拦截器
axios.interceptors.response.use(function (response) {
  // 隐藏loading
  store.dispatch(changeLoading())
  return response;
}, function (error) {
  // 隐藏loading
  store.dispatch(changeLoading())
  return Promise.reject(error);
});
```

## 5. 权限控制流程

### 5.1 权限控制流程图

#### 5.1.1 基础权限控制流程图

```
┌─────────────┐     ┌─────────────┐     ┌─────────────┐
│  用户登录   │────▶│ 获取用户角色 │────▶│ 获取权限列表 │
└─────────────┘     └─────────────┘     └─────────────┘
                                               │
                                               ▼
┌─────────────┐     ┌─────────────┐     ┌─────────────┐
│ 权限验证失败 │◀────│  权限验证   │◀────│ 存储权限数据 │
│ 重定向到    │     │            │     │ localStorage │
│ 无权限页面  │     └─────────────┘     └─────────────┘
└─────────────┘           │
                          │
                          ▼
                    ┌─────────────┐     ┌─────────────┐
                    │ 动态生成路由 │────▶│ 渲染侧边菜单 │
                    └─────────────┘     └─────────────┘
```

#### 5.1.2 详细权限控制流程图

```
┌───────────────────────────────────────────────────────────────────┐
│                           登录流程                                 │
│                                                                   │
│  ┌─────────────┐    ┌─────────────┐    ┌─────────────────────┐    │
│  │             │    │             │    │                     │    │
│  │  登录表单   │───▶│  验证凭据   │───▶│  获取用户信息       │    │
│  │  提交       │    │             │    │  (用户名、角色)     │    │
│  │             │    │             │    │                     │    │
│  └─────────────┘    └─────────────┘    └─────────────────────┘    │
│                                                   │              │
│                                                   ▼              │
│                                         ┌─────────────────────┐ │
│                                         │                     │ │
│                                         │  获取角色权限列表   │ │
│                                         │                     │ │
│                                         └─────────────────────┘ │
│                                                   │              │
│                                                   ▼              │
│                                         ┌─────────────────────┐ │
│                                         │                     │ │
│                                         │  存储到localStorage │ │
│                                         │                     │ │
│                                         └─────────────────────┘ │
│                                                   │              │
└───────────────────────────────────────────────────────────────────┘
                                                   │
                                                   ▼
┌───────────────────────────────────────────────────────────────────┐
│                           路由控制                                │
│                                                                   │
│  ┌─────────────┐    ┌─────────────┐    ┌─────────────────────┐    │
│  │             │    │             │    │                     │    │
│  │  路由配置   │───▶│  权限过滤   │───▶│  动态生成路由       │    │
│  │  定义       │    │  路由       │    │                     │    │
│  │             │    │             │    │                     │    │
│  └─────────────┘    └─────────────┘    └─────────────────────┘    │
│                                                   │              │
│                                                   ▼              │
│  ┌─────────────┐                        ┌─────────────────────┐ │
│  │             │                        │                     │ │
│  │  路由守卫   │◀───────────────────────│  React Router       │ │
│  │  验证       │                        │  渲染               │ │
│  │             │                        │                     │ │
│  └─────────────┘                        └─────────────────────┘ │
│         │                                                        │
│         ▼                                                        │
│  ┌─────────────┐    ┌─────────────┐                              │
│  │             │    │             │                              │
│  │  有权限     │    │  无权限     │                              │
│  │  渲染组件   │    │  重定向     │                              │
│  │             │    │             │                              │
│  └─────────────┘    └─────────────┘                              │
│                                                                   │
└───────────────────────────────────────────────────────────────────┘
                            │
                            ▼
┌───────────────────────────────────────────────────────────────────┐
│                           UI权限控制                              │
│                                                                   │
│  ┌─────────────┐    ┌─────────────┐    ┌─────────────────────┐    │
│  │             │    │             │    │                     │    │
│  │  侧边菜单   │    │  权限过滤   │    │  动态渲染菜单       │    │
│  │  配置       │───▶│  菜单项     │───▶│                     │    │
│  │             │    │             │    │                     │    │
│  └─────────────┘    └─────────────┘    └─────────────────────┘    │
│                                                                   │
│  ┌─────────────┐    ┌─────────────┐    ┌─────────────────────┐    │
│  │             │    │             │    │                     │    │
│  │  按钮权限   │    │  权限检查   │    │  条件渲染按钮       │    │
│  │  配置       │───▶│  按钮       │───▶│                     │    │
│  │             │    │             │    │                     │    │
│  └─────────────┘    └─────────────┘    └─────────────────────┘    │
│                                                                   │
└───────────────────────────────────────────────────────────────────┘
```

### 5.2 权限控制详细流程

#### 5.2.1 用户登录

```jsx
// src/views/login/Login.js
import React, { useEffect } from 'react';
import { Form, Input, Button, message } from 'antd';
import { UserOutlined, LockOutlined } from '@ant-design/icons';
import { useNavigate } from 'react-router-dom';
import './Login.css';
import axios from 'axios';
import { useDispatch } from 'react-redux';
import { setUserInfo } from '../../redux/slices/userSlice';

export default function Login() {
  const navigate = useNavigate();
  const dispatch = useDispatch();
  
  // 如果已登录，直接跳转到首页
  useEffect(() => {
    const token = localStorage.getItem('token');
    if (token) {
      navigate('/');
    }
  }, [navigate]);

  const onFinish = (values) => {
    // 模拟API请求
    axios.get(`/users?username=${values.username}&password=${values.password}&_expand=role`).then(res => {
      if (res.data.length === 0) {
        message.error('用户名或密码不正确');
      } else {
        const userInfo = res.data[0];
        // 存储用户信息到localStorage
        localStorage.setItem('token', JSON.stringify(userInfo));
        // 同时存储到Redux中，方便全局使用
        dispatch(setUserInfo(userInfo));
        // 登录成功后跳转到首页
        navigate('/');
      }
    }).catch(err => {
      message.error('登录请求失败，请稍后重试');
      console.error('登录失败:', err);
    });
  };

  return (
    <div className="login-container">
      <div className="login-form">
        <h2>全球新闻管理系统</h2>
        <Form
          name="normal_login"
          className="login-form"
          onFinish={onFinish}
        >
          <Form.Item
            name="username"
            rules={[{ required: true, message: '请输入用户名!' }]}
          >
            <Input prefix={<UserOutlined />} placeholder="用户名" />
          </Form.Item>
          <Form.Item
            name="password"
            rules={[{ required: true, message: '请输入密码!' }]}
          >
            <Input
              prefix={<LockOutlined />}
              type="password"
              placeholder="密码"
            />
          </Form.Item>
          <Form.Item>
            <Button type="primary" htmlType="submit" className="login-form-button" block>
              登录
            </Button>
          </Form.Item>
        </Form>
      </div>
    </div>
  );
}
```

#### 5.2.2 权限数据获取与存储

```jsx
// src/redux/slices/userSlice.js
import { createSlice } from '@reduxjs/toolkit';
import axios from 'axios';

const userSlice = createSlice({
  name: 'user',
  initialState: {
    userInfo: null,
    isLoading: false,
    error: null
  },
  reducers: {
    setUserInfo: (state, action) => {
      state.userInfo = action.payload;
    },
    clearUserInfo: (state) => {
      state.userInfo = null;
      // 同时清除localStorage中的token
      localStorage.removeItem('token');
    },
    setLoading: (state, action) => {
      state.isLoading = action.payload;
    },
    setError: (state, action) => {
      state.error = action.payload;
    }
  }
});

export const { setUserInfo, clearUserInfo, setLoading, setError } = userSlice.actions;

// 异步获取用户权限的thunk
export const fetchUserRights = () => async (dispatch, getState) => {
  const { userInfo } = getState().user;
  if (!userInfo) return;
  
  dispatch(setLoading(true));
  try {
    // 获取用户角色的权限列表
    const response = await axios.get(`/roles/${userInfo.roleId}`);
    const updatedUserInfo = {
      ...userInfo,
      role: response.data
    };
    // 更新Redux和localStorage
    dispatch(setUserInfo(updatedUserInfo));
    localStorage.setItem('token', JSON.stringify(updatedUserInfo));
    dispatch(setLoading(false));
  } catch (error) {
    dispatch(setError(error.message));
    dispatch(setLoading(false));
  }
};

export default userSlice.reducer;
```

```jsx
// 登录成功后，将用户信息和角色信息存储到localStorage和Redux
// 示例用户数据结构
const userInfo = {
  id: 1,
  username: 'admin',
  roleId: 1,
  role: {
    id: 1,
    roleName: '超级管理员',
    roleType: 1,
    rights: ['home', 'user-manage', 'right-manage', 'news-manage', 'audit-manage', 'publish-manage'],
    children: [
      {
        id: 11,
        title: '用户列表',
        key: '/user-manage/list',
        pagepermission: 1
      },
      {
        id: 21,
        title: '角色列表',
        key: '/right-manage/role/list',
        pagepermission: 1
      },
      // 更多子权限...
    ]
  }
};

// 存储到localStorage
localStorage.setItem('token', JSON.stringify(userInfo));

// 存储到Redux
dispatch(setUserInfo(userInfo));
```

#### 5.2.3 动态路由生成

```jsx
// src/router/IndexRouter.js
import React, { useEffect, useState } from 'react';
import { Routes, Route, Navigate } from 'react-router-dom';
import { useSelector } from 'react-redux';
import Login from '../views/login/Login';
import NewsSandBox from '../views/sandbox/NewsSandBox';
import Home from '../views/sandbox/home/Home';
import UserList from '../views/sandbox/user-manage/UserList';
import RoleList from '../views/sandbox/right-manage/RoleList';
import RightList from '../views/sandbox/right-manage/RightList';
import NewsAdd from '../views/sandbox/news-manage/NewsAdd';
import NewsDraft from '../views/sandbox/news-manage/NewsDraft';
import NewsCategory from '../views/sandbox/news-manage/NewsCategory';
import Audit from '../views/sandbox/audit-manage/Audit';
import AuditList from '../views/sandbox/audit-manage/AuditList';
import Unpublished from '../views/sandbox/publish-manage/Unpublished';
import Published from '../views/sandbox/publish-manage/Published';
import Sunset from '../views/sandbox/publish-manage/Sunset';
import NoPermission from '../views/sandbox/nopermission/NoPermission';
import NewsPreview from '../views/sandbox/news-manage/NewsPreview';
import NewsUpdate from '../views/sandbox/news-manage/NewsUpdate';

// 路由映射表
const LocalRouterMap = {
  '/home': <Home />,
  '/user-manage/list': <UserList />,
  '/right-manage/role/list': <RoleList />,
  '/right-manage/right/list': <RightList />,
  '/news-manage/add': <NewsAdd />,
  '/news-manage/draft': <NewsDraft />,
  '/news-manage/category': <NewsCategory />,
  '/news-manage/preview/:id': <NewsPreview />,
  '/news-manage/update/:id': <NewsUpdate />,
  '/audit-manage/audit': <Audit />,
  '/audit-manage/list': <AuditList />,
  '/publish-manage/unpublished': <Unpublished />,
  '/publish-manage/published': <Published />,
  '/publish-manage/sunset': <Sunset />
};

export default function IndexRouter() {
  const [backRouteList, setBackRouteList] = useState([]);
  const userInfo = useSelector(state => state.user.userInfo);

  useEffect(() => {
    // 获取当前用户的权限列表
    const token = localStorage.getItem('token');
    if (token) {
      const { role } = JSON.parse(token);
      if (role && role.rights) {
        // 根据权限过滤路由
        const routes = Object.keys(LocalRouterMap).filter(item => {
          // 如果是详情页面，不需要权限验证或检查父级权限
          if (item.includes(':')) {
            const baseRoute = item.split(':')[0].slice(0, -1);
            return role.rights.includes(baseRoute.split('/')[1]);
          }
          // 检查一级权限
          const mainRoute = item.split('/')[1];
          return role.rights.includes(mainRoute);
        });
        setBackRouteList(routes);
      }
    }
  }, [userInfo]); // 当用户信息变化时重新计算路由

  // 路由守卫组件
  const AuthComponent = ({ children }) => {
    const token = localStorage.getItem('token');
    return token ? children : <Navigate to="/login" replace />;
  };

  return (
    <Routes>
      <Route path="/login" element={<Login />} />
      <Route path="/" element={
        <AuthComponent>
          <NewsSandBox />
        </AuthComponent>
      }>
        {/* 动态生成的路由 */}
        {backRouteList.map(item => {
          return <Route path={item} key={item} element={LocalRouterMap[item]} />;
        })}
        {/* 默认路由 */}
        <Route path="/" element={<Navigate to="/home" replace />} />
        {/* 无权限路由 */}
        <Route path="*" element={<NoPermission />} />
      </Route>
    </Routes>
  );
}
```

#### 5.2.4 侧边菜单渲染

```jsx
// src/components/sandbox/SideMenu.js
import React, { useEffect, useState } from 'react';
import { Layout, Menu } from 'antd';
import { useNavigate, useLocation } from 'react-router-dom';
import { useSelector } from 'react-redux';
import axios from 'axios';
import {
  HomeOutlined,
  UserOutlined,
  KeyOutlined,
  FileTextOutlined,
  AuditOutlined,
  CloudUploadOutlined
} from '@ant-design/icons';
import './SideMenu.css';

const { Sider } = Layout;
const { SubMenu } = Menu;

// 图标映射表
const iconMap = {
  '/home': <HomeOutlined />,
  '/user-manage': <UserOutlined />,
  '/right-manage': <KeyOutlined />,
  '/news-manage': <FileTextOutlined />,
  '/audit-manage': <AuditOutlined />,
  '/publish-manage': <CloudUploadOutlined />
};

export default function SideMenu(props) {
  const [menu, setMenu] = useState([]);
  const navigate = useNavigate();
  const location = useLocation();
  const userInfo = useSelector(state => state.user.userInfo);
  const collapsed = useSelector(state => state.app.collapsed);
  
  // 当前选中的菜单项和展开的子菜单
  const selectedKeys = [location.pathname];
  const openKeys = ['/' + location.pathname.split('/')[1]];

  useEffect(() => {
    // 获取菜单数据
    axios.get('/rights?_embed=children').then(res => {
      if (!userInfo || !userInfo.role || !userInfo.role.rights) return;
      
      // 获取当前用户的权限列表
      const { rights } = userInfo.role;
      
      // 根据权限过滤菜单
      const menuList = res.data.filter(item => {
        // 如果当前用户有该权限，则显示该菜单
        if (rights.includes(item.key)) {
          // 过滤子菜单
          if (item.children?.length > 0) {
            item.children = item.children.filter(child => 
              child.pagepermission === 1 && rights.includes(child.key)
            );
          }
          // 只返回有页面权限的菜单
          return item.pagepermission === 1;
        }
        return false;
      });
      
      setMenu(menuList);
    }).catch(err => {
      console.error('获取菜单失败:', err);
    });
  }, [userInfo]); // 当用户信息变化时重新获取菜单

  // 渲染菜单项
  const renderMenu = (menuList) => {
    return menuList.map(item => {
      if (item.children?.length > 0 && item.children.some(child => child.pagepermission === 1)) {
        return (
          <SubMenu 
            key={item.key} 
            icon={iconMap[item.key]} 
            title={item.title}
          >
            {renderMenu(item.children)}
          </SubMenu>
        );
      }
      return (
        <Menu.Item 
          key={item.key} 
          icon={iconMap[item.key] || null} 
          onClick={() => navigate(item.key)}
        >
          {item.title}
        </Menu.Item>
      );
    });
  };

  return (
    <Sider 
      trigger={null} 
      collapsible 
      collapsed={collapsed}
      className="side-menu"
    >
      <div className="logo">
        {collapsed ? '新闻' : '全球新闻管理系统'}
      </div>
      <Menu 
        theme="dark" 
        mode="inline" 
        selectedKeys={selectedKeys} 
        defaultOpenKeys={collapsed ? [] : openKeys}
      >
        {renderMenu(menu)}
      </Menu>
    </Sider>
  );
}
```

#### 5.2.5 路由访问控制

```jsx
// src/components/auth/PermissionRoute.js
import React from 'react';
import { Navigate, useLocation } from 'react-router-dom';
import { message } from 'antd';

/**
 * 权限路由组件
 * @param {Object} props
 * @param {React.ReactNode} props.children - 子组件
 * @param {string} props.requiredPermission - 需要的权限
 * @returns {React.ReactNode}
 */
export default function PermissionRoute({ children, requiredPermission }) {
  const location = useLocation();
  const token = localStorage.getItem('token');
  
  // 检查是否登录
  if (!token) {
    message.error('请先登录');
    return <Navigate to="/login" state={{ from: location }} replace />;
  }
  
  // 如果没有指定权限要求，直接渲染子组件
  if (!requiredPermission) {
    return children;
  }
  
  // 检查是否有权限
  const { role } = JSON.parse(token);
  if (!role || !role.rights) {
    message.error('权限信息不完整，请重新登录');
    return <Navigate to="/login" state={{ from: location }} replace />;
  }
  
  // 检查是否有访问权限
  if (!role.rights.includes(requiredPermission)) {
    message.error('您没有访问该页面的权限');
    return <Navigate to="/nopermission" replace />;
  }
  
  // 有权限，渲染子组件
  return children;
}

// 使用示例
<Route 
  path="/user-manage/list" 
  element={
    <PermissionRoute requiredPermission="user-manage">
      <UserList />
    </PermissionRoute>
  } 
/>
```

```jsx
// 按钮级权限控制组件
// src/components/auth/PermissionButton.js
import React from 'react';
import { Button } from 'antd';
import { useSelector } from 'react-redux';

/**
 * 权限按钮组件
 * @param {Object} props
 * @param {string} props.permission - 需要的权限
 * @param {React.ReactNode} props.children - 子组件
 * @param {Function} props.onClick - 点击事件
 * @param {Object} props.rest - 其他Button组件属性
 * @returns {React.ReactNode}
 */
export default function PermissionButton({ permission, children, onClick, ...rest }) {
  const userInfo = useSelector(state => state.user.userInfo);
  
  // 检查是否有权限
  const hasPermission = () => {
    if (!userInfo || !userInfo.role || !userInfo.role.rights) {
      return false;
    }
    return userInfo.role.rights.includes(permission);
  };
  
  // 如果没有权限，不渲染按钮
  if (!hasPermission()) {
    return null;
  }
  
  // 有权限，渲染按钮
  return (
    <Button onClick={onClick} {...rest}>
      {children}
    </Button>
  );
}

// 使用示例
<PermissionButton 
  permission="news-manage-add" 
  type="primary" 
  onClick={handleAdd}
>
  添加新闻
</PermissionButton>
```

### 5.3 权限粒度说明

本系统实现了以下几个层级的权限控制：

1. **路由级权限**：控制用户可以访问哪些页面
   - 通过动态路由生成实现
   - 使用路由守卫组件进行权限验证
   - 无权限时重定向到无权限页面

2. **菜单级权限**：控制用户可以看到哪些菜单项
   - 根据用户权限动态渲染侧边菜单
   - 菜单项与权限一一对应
   - 支持多级菜单的权限控制

3. **按钮级权限**：控制用户可以操作哪些功能按钮
   - 通过自定义的`PermissionButton`组件实现
   - 根据用户权限动态显示或隐藏按钮
   - 支持细粒度的操作权限控制

4. **数据级权限**：控制用户可以查看和操作哪些数据
   - 通过API请求时携带用户角色信息实现
   - 后端根据用户角色过滤数据
   - 区域编辑只能查看和编辑自己区域的新闻
   - 超级管理员可以查看和操作所有数据

5. **功能级权限**：控制用户可以使用哪些功能
   - 新闻撰写人只能创建、编辑和删除自己的新闻
   - 编辑可以审核新闻但不能发布
   - 发布人员可以发布和下线新闻
   - 管理员可以管理用户和权限

### 5.3 权限粒度

系统实现了多级权限控制：

1. **页面级权限**：控制用户可访问的页面
2. **按钮级权限**：控制用户可操作的功能按钮
3. **数据级权限**：控制用户可查看和管理的数据范围
   - 超级管理员：可查看和管理所有数据
   - 区域管理员：只能查看和管理所属区域的数据

## 6. 新闻工作流

### 6.1 新闻工作流程图

```
┌─────────────┐     ┌─────────────┐     ┌─────────────┐
│  创建新闻   │────▶│  保存草稿   │────▶│  提交审核   │
└─────────────┘     └─────────────┘     └─────────────┘
                                               │
                                               ▼
┌─────────────┐     ┌─────────────┐     ┌─────────────┐
│   驳回     │◀────│  审核新闻   │────▶│   通过     │
└─────────────┘     └─────────────┘     └─────────────┘
      │                                        │
      │                                        ▼
      │                                  ┌─────────────┐
      │                                  │  待发布    │
      │                                  └─────────────┘
      │                                        │
      ▼                                        ▼
┌─────────────┐                         ┌─────────────┐
│  修改新闻   │                         │   发布     │
└─────────────┘                         └─────────────┘
                                               │
                                               ▼
                                        ┌─────────────┐
                                        │  已发布    │
                                        └─────────────┘
                                               │
                                               ▼
                                        ┌─────────────┐     ┌─────────────┐
                                        │   下线     │────▶│   删除     │
                                        └─────────────┘     └─────────────┘
```

### 6.2 新闻状态定义

新闻在系统中有以下几种状态：

1. **草稿状态**（`auditState: 0`）：新闻创建后的初始状态
2. **审核中状态**（`auditState: 1`）：提交审核后的状态
3. **已通过状态**（`auditState: 2`）：审核通过的状态
4. **已驳回状态**（`auditState: 3`）：审核驳回的状态

发布状态：
1. **未发布**（`publishState: 0`）：尚未发布的新闻
2. **待发布**（`publishState: 1`）：待发布的新闻
3. **已发布**（`publishState: 2`）：已上线的新闻
4. **已下线**（`publishState: 3`）：已下线的新闻

### 6.3 新闻工作流详细流程

1. **创建新闻**
   - 编辑撰写新闻内容，包括标题、分类、内容等
   - 可以保存为草稿（`auditState: 0`）

2. **提交审核**
   - 编辑将草稿提交审核（`auditState: 1`）
   - 新闻进入审核列表

3. **审核新闻**
   - 管理员审核新闻
   - 通过：新闻状态变为已通过（`auditState: 2`）
   - 驳回：新闻状态变为已驳回（`auditState: 3`）

4. **发布新闻**
   - 审核通过的新闻可以发布（`publishState: 2`）
   - 发布后的新闻在前台可见

5. **下线新闻**
   - 已发布的新闻可以下线（`publishState: 3`）
   - 下线后的新闻在前台不可见

6. **删除/重新发布**
   - 已下线的新闻可以删除
   - 也可以重新发布（`publishState: 2`）

## 7. 系统配置

### 7.1 开发环境配置

#### 7.1.1 前端配置

- 开发服务器端口：3000
- 开发启动命令：`npm start`
- 热更新：支持
- 环境变量：通过`.env`文件配置

```bash
# .env.development 示例
REACT_APP_API_URL=http://localhost:8000
REACT_APP_ENV=development
```

#### 7.1.2 后端模拟配置

- JSON Server端口：8000
- 启动命令：`json-server --watch db.json --port 8000`
- 数据文件：`db.json`
- API基础URL：http://localhost:8000

#### 7.1.3 HTTP请求配置

```javascript
// src/util/http.js
import axios from 'axios'
import { store } from '../redux/store'
import { changeLoading } from '../redux/reducers/LoadingReducer'

axios.defaults.baseURL = 'http://localhost:8000'

// 请求拦截器
axios.interceptors.request.use(function (config) {
  // 显示loading
  store.dispatch(changeLoading())
  return config;
}, function (error) {
  return Promise.reject(error);
});

// 响应拦截器
axios.interceptors.response.use(function (response) {
  // 隐藏loading
  store.dispatch(changeLoading())
  return response;
}, function (error) {
  // 隐藏loading
  store.dispatch(changeLoading())
  return Promise.reject(error);
});
```

### 7.2 生产环境配置

#### 7.2.1 构建配置

- 构建命令：`npm run build`
- 输出目录：`/build`
- 环境变量：通过`.env.production`文件配置

```bash
# .env.production 示例
REACT_APP_API_URL=https://api.example.com
REACT_APP_ENV=production
GENERATE_SOURCEMAP=false
```

#### 7.2.2 性能优化配置

- 代码分割：使用React.lazy和Suspense实现组件懒加载
- 静态资源优化：图片压缩、CSS压缩
- 缓存策略：配置合理的缓存头

```javascript
// 组件懒加载示例
import React, { lazy, Suspense } from 'react';

const NewsDraft = lazy(() => import('./views/sandbox/news-manage/NewsDraft'));

// 在路由中使用
<Suspense fallback={<div>Loading...</div>}>
  <Route path="/news-manage/draft" element={<NewsDraft />} />
</Suspense>
```

### 7.3 系统参数配置

系统的关键参数配置如下：

#### 7.3.1 新闻相关参数

- 新闻审核状态：
  ```javascript
  const auditStateList = [
    { id: 0, title: "草稿箱" },
    { id: 1, title: "审核中" },
    { id: 2, title: "已通过" },
    { id: 3, title: "未通过" }
  ];
  ```

- 新闻发布状态：
  ```javascript
  const publishStateList = [
    { id: 0, title: "未发布" },
    { id: 1, title: "待发布" },
    { id: 2, title: "已发布" },
    { id: 3, title: "已下线" }
  ];
  ```

#### 7.3.2 权限相关参数

- 权限类型：
  ```javascript
  const rightTypeList = [
    { id: 1, title: "菜单" },
    { id: 2, title: "按钮" }
  ];
  ```

- 角色类型：
  ```javascript
  const roleTypeList = [
    { id: 1, title: "超级管理员" },
    { id: 2, title: "区域管理员" },
    { id: 3, title: "区域编辑" }
  ];
  ```

### 7.4 第三方服务配置

#### 7.4.1 富文本编辑器配置

```javascript
// 富文本编辑器配置示例
import { Editor } from "react-draft-wysiwyg";
import "react-draft-wysiwyg/dist/react-draft-wysiwyg.css";

<Editor
  editorState={editorState}
  toolbarClassName="toolbarClassName"
  wrapperClassName="wrapperClassName"
  editorClassName="editorClassName"
  onEditorStateChange={handleEditorChange}
  toolbar={{
    image: { uploadCallback: uploadImageCallback },
    fontFamily: {
      options: ['宋体', '黑体', '楷体', '微软雅黑', 'Arial', 'Georgia', 'Impact', 'Tahoma', 'Times New Roman'],
    }
  }}
/>
```

#### 7.4.2 图表配置

```javascript
// ECharts配置示例
import ReactECharts from 'echarts-for-react';

<ReactECharts
  option={{
    title: {
      text: '新闻分类图示'
    },
    tooltip: {},
    legend: {
      data: ['数量']
    },
    xAxis: {
      data: pieList.map(item => item.title)
    },
    yAxis: {},
    series: [{
      name: '数量',
      type: 'bar',
      data: pieList.map(item => item.value)
    }]
  }}
/>
```

## 8. 扩展与优化方向

1. 添加真实后端API替代JSON Server
2. 实现用户注册功能
3. 增强富文本编辑器功能
4. 添加评论系统
5. 实现数据统计与分析功能
6. 优化移动端适配
7. 添加多语言支持
8. 实现更细粒度的权限控制

## 9. 部署指南

### 9.1 开发环境部署

#### 9.1.1 前端部署

1. **克隆项目**
   ```bash
   git clone <项目仓库地址>
   cd newsystem
   ```

2. **安装依赖**
   ```bash
   npm install
   ```

3. **启动JSON Server**
   ```bash
   json-server --watch db.json --port 8000
   ```

4. **启动开发服务器**
   ```bash
   npm start
   ```
   应用将在 http://localhost:3000 运行

#### 9.1.2 环境要求

- Node.js >= 14.0.0
- npm >= 6.0.0
- 现代浏览器（Chrome, Firefox, Safari, Edge等）

### 9.2 生产环境部署

#### 9.2.1 构建生产版本

1. **构建项目**
   ```bash
   npm run build
   ```
   这将在`build`目录生成生产版本文件

2. **部署到静态服务器**
   将`build`目录中的文件部署到静态文件服务器（如Nginx, Apache等）

#### 9.2.2 Nginx配置示例

```nginx
server {
    listen 80;
    server_name your-domain.com;
    root /path/to/build;
    index index.html;

    location / {
        try_files $uri $uri/ /index.html;
    }

    # API代理配置
    location /api/ {
        proxy_pass http://your-backend-api/;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
    }
}
```

#### 9.2.3 后端API部署

在生产环境中，应替换JSON Server为实际的后端API服务。需要修改`src/util/http.js`中的API基础URL：

```javascript
axios.defaults.baseURL = 'https://your-production-api.com';
```

### 9.3 持续集成/持续部署(CI/CD)

可以使用GitHub Actions, Jenkins, GitLab CI等工具实现自动化部署流程：

1. 代码提交触发自动测试
2. 测试通过后自动构建
3. 构建成功后自动部署到测试/生产环境

## 10. 常见问题与解决方案

### 10.1 登录问题

**问题**: 登录后立即被重定向回登录页面

**解决方案**:
- 检查localStorage中的token是否正确保存
- 确认JSON Server是否正常运行
- 检查用户权限配置是否正确

### 10.2 权限问题

**问题**: 用户无法访问应有权限的页面

**解决方案**:
- 检查用户角色权限配置
- 确认路由权限控制逻辑
- 清除浏览器缓存后重新登录

### 10.3 新闻管理问题

**问题**: 新闻保存后无法在列表中显示

**解决方案**:
- 检查新闻状态是否正确设置
- 确认用户是否有查看该新闻的权限
- 检查API请求是否成功

### 10.4 富文本编辑器问题

**问题**: 富文本编辑器无法正常加载或保存内容

**解决方案**:
- 检查Draft.js相关依赖版本兼容性
- 确认内容格式是否正确
- 尝试清除浏览器缓存

### 10.5 性能优化

**问题**: 系统在数据量大时响应缓慢

**解决方案**:
- 实现列表数据分页加载
- 优化Redux状态管理，减少不必要的重渲染
- 使用React.memo和useMemo优化组件性能
- 实现数据缓存策略

## 11. 附录

### 11.1 常用代码片段

#### 11.1.1 权限检查

```javascript
// 检查用户是否有权限访问某个路由
const checkUserPermission = (path) => {
  const { role: { rights } } = JSON.parse(localStorage.getItem("token") || "{}");
  return rights?.includes(path);
};

// 检查用户是否有权限操作某个按钮
const checkButtonPermission = (right) => {
  const { role: { rights } } = JSON.parse(localStorage.getItem("token") || "{}");
  return rights?.includes(right);
};
```

#### 11.1.2 日期格式化

```javascript
// 使用Moment.js格式化日期
import moment from 'moment';

// 格式化为YYYY-MM-DD
const formatDate = (date) => {
  return moment(date).format('YYYY-MM-DD');
};

// 格式化为YYYY-MM-DD HH:mm:ss
const formatDateTime = (date) => {
  return moment(date).format('YYYY-MM-DD HH:mm:ss');
};

// 计算相对时间（如：3小时前）
const fromNow = (date) => {
  return moment(date).fromNow();
};
```

#### 11.1.3 数据过滤

```javascript
// 根据用户角色过滤数据
const filterDataByRole = (dataList) => {
  const { roleId, region, username } = JSON.parse(localStorage.getItem("token"));
  if (roleId === 1) {
    // 超级管理员可以查看所有数据
    return dataList;
  } else {
    // 区域管理员只能查看自己区域的数据
    return dataList.filter(item => {
      return item.region === region && item.roleId >= roleId;
    });
  }
};
```

### 11.2 开发参考资料

#### 11.2.1 官方文档

- [React 官方文档](https://reactjs.org/docs/getting-started.html)
- [React Router 官方文档](https://reactrouter.com/en/main)
- [Redux Toolkit 官方文档](https://redux-toolkit.js.org/introduction/getting-started)
- [Ant Design 组件库文档](https://ant.design/components/overview/)
- [Draft.js 富文本编辑器文档](https://draftjs.org/docs/getting-started)
- [ECharts 图表库文档](https://echarts.apache.org/handbook/en/get-started/)

#### 11.2.2 学习资源

- React Hooks 最佳实践
- Redux 状态管理模式
- React 性能优化技巧
- 前端权限控制方案
- JSON Server 使用指南

#### 11.2.3 推荐工具

- **开发工具**：VS Code、WebStorm
- **调试工具**：React Developer Tools、Redux DevTools
- **API测试**：Postman、Insomnia
- **版本控制**：Git、GitHub Desktop
- **代码规范**：ESLint、Prettier

### 11.3 项目依赖版本对照表

| 依赖包 | 版本 | 用途 |
|-------|------|------|
| react | 18.2.0 | 前端框架 |
| react-dom | 18.2.0 | DOM操作 |
| react-router-dom | 6.14.2 | 路由管理 |
| @reduxjs/toolkit | 1.9.5 | 状态管理 |
| react-redux | 8.1.2 | Redux绑定 |
| redux-persist | 6.0.0 | 状态持久化 |
| antd | 5.26.2 | UI组件库 |
| axios | 1.4.0 | HTTP请求 |
| draft-js | 0.11.7 | 富文本编辑 |
| react-draft-wysiwyg | 1.15.0 | 富文本编辑器 |
| echarts | 5.4.3 | 数据可视化 |
| echarts-for-react | 3.0.2 | React ECharts |
| moment | 2.29.4 | 日期处理 |
| nprogress | 0.2.0 | 进度条 |
| json-server | 0.17.3 | 模拟后端 |